import{g as r,c as d,o as w,a as y,t as b,b as m,r as p,d as f,e as I}from"./index-DBoCCed_.chunk.mjs";const g={"OCS-APIRequest":"true",Accept:"application/json"},h=21,S=22,x=23;function _(e){return e?.data?.ocs?.data}function k(e){return e?.data??[]}function A(e,c){return k(e).find(t=>t.columnId===c)?.value??""}function C(e){return{data:[{columnId:h,value:String(e.name??"")},{columnId:S,value:e.home?"home":"away"},{columnId:x,value:String(e.last_changed??"")}]}}async function N({tableId:e,persons:c}){const t=r(`/ocs/v2.php/apps/tables/api/2/tables/${e}/rows`),l=await d.get(t,{headers:g}),u=_(l)??[],s=new Map;for(const n of u){const o=A(n,h);o&&s.set(o,n)}for(const n of c){const o=C(n),i=s.get(n.name);if(i?.id){const a=r(`/ocs/v2.php/apps/tables/api/2/rows/${i.id}`);await d.put(a,o,{headers:g})}else{const a=r(`/ocs/v2.php/apps/tables/api/2/tables/${e}/rows`);await d.post(a,o,{headers:g})}}}const O=["disabled"],P={key:1},T={key:2,style:{color:"red"}},$={__name:"App",setup(e){const c=p([]),t=p(!1),l=p(""),u=p(""),s=p(0);async function n(){const a=await d.get(r("/ocs/v2.php/apps/nextcloudpresence/api/v1/presence")),v=a.data.ocs?.data||a.data;c.value=v}async function o(){try{const a=await d.get(r("/ocs/v2.php/apps/nextcloudpresence/settings")),v=a.data.ocs?.data||a.data;s.value=parseInt(v.tables_table_id,10)||0}catch{s.value=0}}async function i(){t.value=!0,l.value="",u.value="";try{await N({tableId:s.value,persons:c.value}),u.value="Synced presence to Tables."}catch(a){l.value=a?.response?.data?JSON.stringify(a.response.data):a?.message||String(a)}finally{t.value=!1}}return w(async()=>{await Promise.all([n(),o()])}),(a,v)=>(f(),y("div",null,[s.value>0?(f(),y("button",{key:0,disabled:t.value,onClick:i},b(t.value?"Syncingâ€¦":"Sync to Nextcloud Tables"),9,O)):m("",!0),u.value?(f(),y("p",P,b(u.value),1)):m("",!0),l.value?(f(),y("p",T,b(l.value),1)):m("",!0)]))}},M=I($);M.mount("#nextcloudpresence");
//# sourceMappingURL=nextcloudpresence-main.mjs.map
